import os
import sys
import shutil
import re
import collections
import pprint

walk_dir = sys.argv[1]

print('walk_dir = ' + walk_dir)

# If your current working directory may change during script execution, it's recommended to
# immediately convert program arguments to an absolute path. Then the variable root below will
# be an absolute path as well. Example:
walk_dir = os.path.abspath(walk_dir)
print('walk_dir (absolute) = ' + os.path.abspath(walk_dir))

# #init counters
# worm_count=trojan_count=exploit_count=0

trojan = " troj_gen trojan trj " #check for downloader dropper?
exploit= " exploit "
worm= " worm "
#worm bagle allaple sytro mydoom mamianune vobfus nimda chir fesber gamarue mortos palevo
backdoor=" backdoor "
#backdoor hupigon pcclient poison bifrose turkojan predator ircbot delf farfli
virus = " funlove vampiro kunkka trafaret troxa bleah slugin tolone hala bolzano relnek hidrag huhk hublo xpaj aliser polip madangel ipamor alman jadtre neshta iparmor otwycal ramnit parite elkern expiro virut virtob virlock virransom sality " #ramnit nimnul elkern  parite alman expiro wapomi
adware = " adware " #softpulse #also contains bundlers, downloaders, droppers, installer, downware spyware
generic = " gen generic " #run last #variant? heuristic? behaveslike?
potentiallyUnwanted = " pup pua unwanted solimba installcore " #solimba unwanted? heuristic? heur?
riskware = " riskware " #hacktool
rootkit=" rootkit "
#runouce virus or email worm?
#chir virus/worm
#viking virus or worm?
#ramnit - trojan or virus?
#fiseria? -adware eywork
#Riskware? included in adware
#trojanDownloaders: genome guagua
#magania - trojware pws
#luder - backdoor?


cnt = collections.Counter()

for root, subdirs, files in os.walk(walk_dir):
    list_file_path = os.path.join(root, '')


    filename = "virustotal.txt"

    if filename in files:
        file_path = os.path.join(root, filename)

        print('\n+++++++++++++++++++++++++++New File Full path: %s' % (file_path))

        with open(file_path) as f:
            words = re.findall(r"\b[^\d\W]+\b", f.read().lower())

            #print most common words in file
            d = collections.Counter(words).most_common(5)
            # pprint.pprint(d)

            #for top 5 words
            for i in range(min(5, len(d))):
                word, count = d[i]
                if word != "virustotal" and word not in "results:" and word != "version": #word not in "virustotal.com:" and
                    print('%s \t %d' % (word, count))
            #
            # for word in d.elements():
            #     #if word not in "virustotal.com: results: version":
                if word != "virustotal" and  word not in "results:" and word != "version": #word not in "virustotal.com:" and
                    if re.search('\W'+word+'\W',trojan):
                        print "==================================> entered TROJAN with word: " + word
                        cnt[word] += 1
                        shutil.move(root, "/home/tarun/Documents/Classified/Trojan")
                        break;
                    elif re.search('\W'+word+'\W',exploit):
                        print "==================================> entered EXPLOIT with word: " + word
                        cnt[word] += 1
                        shutil.move(root, "/home/tarun/Documents/Classified/Exploit")
                        break;
                    elif re.search('\W'+word+'\W',worm):
                        print "==================================>  entered WORM with word: " + word
                        cnt[word] += 1
                        shutil.move(root, "/home/tarun/Documents/Classified/Worm")
                        break;
                    elif re.search('\W'+word+'\W',backdoor):
                        print "==================================>  entered BACKDOOR with word: " + word
                        cnt[word] += 1
                        shutil.move(root, "/home/tarun/Documents/Classified/Backdoor")
                        break;
                    elif re.search('\W'+word+'\W',virus):
                        print "==================================>  entered VIRUS with word: " + word
                        cnt[word] += 1
                        shutil.move(root, "/home/tarun/Documents/Classified/Virus")
                        break;
                    elif re.search('\W'+word+'\W',generic):
                        print "==================================>  entered GENERIC with word: " + word
                        cnt[word] += 1
                        shutil.move(root, "/home/tarun/Documents/Classified/Generic")
                        break;
                    elif re.search('\W'+word+'\W',adware):
                        print "==================================>  entered ADWARE with word: " + word
                        cnt[word] += 1
                        shutil.move(root, "/home/tarun/Documents/Classified/Adware")
                        break;
                    elif re.search('\W'+word+'\W',potentiallyUnwanted):
                        print "==================================>  entered POTENTIALLY UNWANTED PROGRAM/APPLICATION with word: " + word
                        cnt[word] += 1
                        shutil.move(root, "/home/tarun/Documents/Classified/PotentiallyUnwanted")
                        break;
                    elif re.search('\W'+word+'\W',riskware):
                        print "==================================>  entered RISKWARE with word: " + word
                        cnt[word] += 1
                        shutil.move(root, "/home/tarun/Documents/Classified/Riskware")
                        break;
                    elif re.search('\W'+word+'\W',rootkit):
                        print "==================================>  entered Rootkit with word: " + word
                        cnt[word] += 1
                        shutil.move(root, "/home/tarun/Documents/Classified/Rootkit")
                        break;
         #    # Get the set of unique words.
	    # uniques = []
        #
        # for word in words:
         #        # if word not in uniques and word not in "virustotal.com:" and word not in "results:" and word != "version":
         #       #  uniques.append(word)
        #
	    # # Make a list of (count, unique) tuples.
	    # counts = []
	    # for unique in uniques:
         #        count = 0              # Initialize the count to zero.
         #        for word in words:     # Iterate over the words.
         #            if word == unique:   # Is this word equal to the current unique?
         #  	        count += 1         # If so, increment the count
         #  	counts.append((count, unique))
        #
	    # counts.sort()            # Sorting the list puts the lowest counts first.
	    # counts.reverse()         # Reverse it, putting the highest counts first.
	    # #Print the ten words with the highest counts.
	    # print('\n+++++++++++++++++++++++++++New File Full path: %s' % (file_path))
	    # for i in range(min(10, len(counts))):
         #        count, word = counts[i]
         #        print('%s \t %d' % (word, count))
        #
         #        #CHECK MALWARE TYPE
         #        if ('worm' in word):
         #            worm_count += 1
         #            print(('--\nThe file %s contains: worm ' % file_path).encode('utf-8'))
		 #    print('\n%s \t %d' % (word, count))
		 #    shutil.move(root, "/home/tarun/Documents/Classified/Rootkit")
# 		 #    break;
# print('\n Trojan Count: %d' % cnt[trojan])
# print('\n Exploit Count: %d' % cnt[exploit])
# print('\n Worm Count: %d' % cnt[worm])
pprint.pprint(cnt) #print all identified keywords
