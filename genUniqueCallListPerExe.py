import os
import sys
import shutil
import re
import collections
import pprint

walk_dir = sys.argv[1]

print('walk_dir = ' + walk_dir)

# If your current working directory may change during script execution, it's recommended to
# immediately convert program arguments to an absolute path. Then the variable root below will
# be an absolute path as well. Example:
walk_dir = os.path.abspath(walk_dir)
print('walk_dir (absolute) = ' + os.path.abspath(walk_dir))


cnt = 0

for root, subdirs, files in os.walk(walk_dir):
    list_file_path = os.path.join(root, '')


    filename = "peinfo-quick.txt"
    # filename = "peinfo-full.txt" #90/109

    if filename in files:
        file_path = os.path.join(root, filename)

        dir = os.path.basename(os.path.normpath(root))

        with open(file_path) as f:
            # lines = re.findall(r"\b.+dll.*\t.*\b", f.read().lower()) #dll, call, address
            lines = re.findall(r"\b.+dll.*\t.*\t\b", f.read().lower())

            if lines:
                # print "==================================> DLLS LINES found"
                # pprint.pprint(lines)
                # cnt+= 1
                print "=====================================================> SYS CALLS"
                for line in lines:
                    lineStr = line.split("\t")
                    with open("/home/tarun/Desktop/test/"+dir+".txt", 'a') as w:
                        # if lineStr[1] not in w.read().lower():
                        print lineStr[1]
                        w.write(lineStr[1]+'\n')
                        cnt+= 1
                # print cnt #print number of unique calls per exe

            #break;

# print cnt #print number of files with sys calls
