import os
import sys
import shutil

walk_dir = sys.argv[1]

print('walk_dir = ' + walk_dir)

# If your current working directory may change during script execution, it's recommended to
# immediately convert program arguments to an absolute path. Then the variable root below will
# be an absolute path as well. Example:
walk_dir = os.path.abspath(walk_dir)
print('walk_dir (absolute) = ' + os.path.abspath(walk_dir))

count32=0
count64=0

for root, subdirs, files in os.walk(walk_dir):
   # if "win32" in root:
    #    break
    #print('--\nroot = ' + root)
    list_file_path = os.path.join(root, '')
    #print('list_file_path = ' + list_file_path)

    #for subdir in subdirs: # list all subdirs
    #    print('\t- subdirectory ' + subdir)

    filename = "virustotal.txt"

    if filename in files:
        file_path = os.path.join(root, filename)

        #print('\t- file %s (full path: %s)' % (filename, file_path))

        with open(file_path, 'rb') as f:
            f_content = f.read()
            #check if win32/w32 and append to fn
            if ('Win32' or 'W32') in f_content:
                count32 += 1
                print(('The file %s contains: Win32 ' % file_path).encode('utf-8'))
                shutil.move(root, "/home/tarun/Documents/Classified/Win32")
                #shutil.move(root, os.path.join(walk_dir,"win32"))
                print "\n moved to: /home/tarun/Documents/Classified/Win32 \n"


            elif ('Win64' or 'W64') in f_content:
                count64 += 1
                print(('The file %s contains: Win64 \n' % file_path).encode('utf-8'))

                shutil.move(root, "/home/tarun/Documents/Classified/Win64")
                #shutil.move(root, os.path.join(walk_dir,"win32"))
                print "\n moved to : /home/tarun/Documents/Classified/Win64 \n"
            #print(f_content)
            #print(b'\n')

print('\n Win32 Count: %d' % count32)
print('\n Win64 Count: %d' % count64)
